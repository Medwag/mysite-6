// Test AutoFix functionality
import { autoFixSubscriptionSync } from 'backend/subscription-sync-diagnostics.jsw';
import { verifyOrRecoverPaystackTransaction } from 'backend/verifyOrRecoverPaystackTransaction.jsw';

/**
 * Test AutoFix for a specific user email
 * @param {string} userEmail - The email address to test
 * @param {string} userId - The Wix user ID (if known)
 */
export async function testAutoFixByEmail(userEmail, userId = null) {
    console.log(`üß™ TESTING AUTOFIX for email: ${userEmail}`);
    console.log(`üë§ User ID: ${userId || 'Will attempt to find'}`);
    
    try {
        // Method 1: Try verifyOrRecoverPaystackTransaction (your enhanced function)
        console.log('\nüîç Method 1: Testing verifyOrRecoverPaystackTransaction...');
        const verifyResult = await verifyOrRecoverPaystackTransaction(userEmail);
        console.log('üìã Verification result:', verifyResult);
        
        // Method 2: Try autoFixSubscriptionSync if we have userId
        let autoFixResult;
        if (userId) {
            console.log('\nüîç Method 2: Testing autoFixSubscriptionSync...');
            autoFixResult = await autoFixSubscriptionSync(userId);
            console.log('üìã AutoFix result:', autoFixResult);
        } else {
            console.log('\n‚ö†Ô∏è Skipping autoFixSubscriptionSync - no userId provided');
            autoFixResult = 'skipped - no userId';
        }
        
        return {
            success: true,
            verifyResult,
            autoFixResult
        };
        
    } catch (error) {
        console.error('‚ùå Test error:', error);
        return {
            success: false,
            error: error.message
        };
    }
}

/**
 * Quick test for your live client
 * Replace with actual email and userId
 */
    const testEmail = process.env.TEST_CLIENT_EMAIL || 'test@example.com'; // Set TEST_CLIENT_EMAIL in your environment
    const testUserId = process.env.TEST_CLIENT_USER_ID || ''; // Set TEST_CLIENT_USER_ID in your environment
    const testEmail = 'your-client@example.com'; // ‚Üê PUT CLIENT EMAIL HERE
    const testUserId = 'client-user-id'; // ‚Üê PUT CLIENT USER ID HERE (if known)
    
    console.log('üß™ TESTING LIVE CLIENT AUTOFIX');
    console.log('üìß Email:', testEmail);
    console.log('üë§ User ID:', testUserId);
    
    return await testAutoFixByEmail(testEmail, testUserId);
}